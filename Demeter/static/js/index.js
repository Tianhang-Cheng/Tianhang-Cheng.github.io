function updateSpeciesImage(e){var t="./static/images/"+e+".jpg",a=$("#species-image");a.length&&(a.attr("src",t),a.attr("alt",e))}function preloadInterpolationImages(){for(var e=0;e<NUM_INTERP_FRAMES;e++){var t=INTERP_BASE+"/"+String(e).padStart(6,"0")+".jpg";interp_images[e]=new Image,interp_images[e].src=t}}function preloadPCAImagesForSpecies(e){for(var t=speciesConfig[e]?speciesConfig[e].base:PCA_BASE,a=1;a<=4;a++){pca_images[a]=[];for(var i=0;i<NUM_INTERP_FRAMES;i++){var o=t+"/pca"+a+"/"+String(i).padStart(6,"0")+".jpg";pca_images[a][i]=new Image,pca_images[a][i].src=o}}}function preloadPCAImagesForSpecies3DLeaf(e){for(var t=speciesConfig3DLeaf[e]?speciesConfig3DLeaf[e].base:PCA_3D_LEAF_BASE,a=1;a<=4;a++){pca_images_3d_leaf[a]=[];for(var i=0;i<NUM_INTERP_FRAMES;i++){var o=t+"/pca"+a+"/"+String(i).padStart(6,"0")+".jpg";pca_images_3d_leaf[a][i]=new Image,pca_images_3d_leaf[a][i].src=o,pca_images_3d_leaf[a][i].onerror=function(){},pca_images_3d_leaf[a][i].onload=function(){}}}}function preloadPCAImagesForSpecies3DStem(e){for(var t=speciesConfig3DStem[e]?speciesConfig3DStem[e].base:PCA_3D_STEM_BASE,a=1;a<=4;a++){pca_images_3d_stem[a]=[];for(var i=0;i<NUM_INTERP_FRAMES;i++){var o=t+"/pca"+a+"/"+String(i).padStart(6,"0")+".jpg";pca_images_3d_stem[a][i]=new Image,pca_images_3d_stem[a][i].src=o,pca_images_3d_stem[a][i].onerror=function(){},pca_images_3d_stem[a][i].onload=function(){}}}}function setInterpolationImage(e,t){var a=interp_images[e];a.ondragstart=function(){return!1},a.oncontextmenu=function(){return!1},$("#"+t).empty().append(a)}function setPCAImage(e,t){var a=pca_images[t][e];a?(a.ondragstart=function(){return!1},a.oncontextmenu=function(){return!1},$("#pca"+t+"-image-wrapper").empty().append(a)):$("#pca"+t+"-image-wrapper").html("<p>Image not found</p>")}function setPCAImage3DLeaf(e,t){var a=pca_images_3d_leaf[t][e];a&&a.complete&&0!==a.naturalWidth?(a.ondragstart=function(){return!1},a.oncontextmenu=function(){return!1},$("#pca"+t+"-image-wrapper-3d-leaf").empty().append(a)):a&&a.src?($("#pca"+t+"-image-wrapper-3d-leaf").html("<p>Loading...</p>"),a.onload=function(){this.complete&&0!==this.naturalWidth&&(this.ondragstart=function(){return!1},this.oncontextmenu=function(){return!1},$("#pca"+t+"-image-wrapper-3d-leaf").empty().append(this))}):$("#pca"+t+"-image-wrapper-3d-leaf").html("<p>Image not available</p>")}function setPCAImage3DStem(e,t){var a=pca_images_3d_stem[t][e];a&&a.complete&&0!==a.naturalWidth?(a.ondragstart=function(){return!1},a.oncontextmenu=function(){return!1},$("#pca"+t+"-image-wrapper-3d-stem").empty().append(a)):a&&a.src?($("#pca"+t+"-image-wrapper-3d-stem").html("<p>Loading...</p>"),a.onload=function(){this.complete&&0!==this.naturalWidth&&(this.ondragstart=function(){return!1},this.oncontextmenu=function(){return!1},$("#pca"+t+"-image-wrapper-3d-stem").empty().append(this))}):$("#pca"+t+"-image-wrapper-3d-stem").html("<p>Image not available</p>")}function init3DViewer(e){var t="pca"+e+"-viewer-3d",a=document.getElementById(t);if(a){a.innerHTML="";var i=new THREE.Scene,o=new THREE.PerspectiveCamera(75,a.offsetWidth/a.offsetHeight,.1,1e3),n=new THREE.WebGLRenderer({antialias:!0});n.setSize(a.offsetWidth,a.offsetHeight),n.setClearColor(16382457),a.appendChild(n.domElement);var r=new THREE.AmbientLight(4210752,.6);i.add(r);var s=new THREE.DirectionalLight(16777215,.8);s.position.set(1,1,1),i.add(s),o.position.z=5,viewers3D[e]={scene:i,camera:o,renderer:n,container:a},load3DMesh(e,0),animate3D(e)}}function load3DMesh(e,t){var a=viewers3D[e];if(a){currentMeshes3D[e]&&a.scene.remove(currentMeshes3D[e]);var i=new THREE.BoxGeometry(1,1,1),o=new THREE.MeshLambertMaterial({color:65280,wireframe:!1}),n=.5+t/100*.5,r=t/100*Math.PI*2;i.scale(n,n,n);var s=new THREE.Mesh(i,o);s.rotation.y=r,a.scene.add(s),currentMeshes3D[e]=s;var c="pca"+e+"-viewer-3d",l=document.getElementById(c);l.querySelector(".viewer-loading")&&(l.querySelector(".viewer-loading").style.display="none")}}function animate3D(e){var t=viewers3D[e];t&&(requestAnimationFrame(function(){animate3D(e)}),currentMeshes3D[e]&&(currentMeshes3D[e].rotation.y+=.01),t.renderer.render(t.scene,t.camera))}function updateSpeciesImage3D(e){var t="./static/images/"+e+".jpg",a=$("#species-image-3d");a.length&&(a.attr("src",t),a.attr("alt",e))}function updateSpeciesImage3DLeaf(e){var t="./static/images/"+e+".jpg",a=$("#species-image-3d-leaf");a.length&&(a.attr("src",t),a.attr("alt",e))}function updateSpeciesImage3DStem(e){var t="./static/images/"+e+".jpg",a=$("#species-image-3d-stem");a.length&&(a.attr("src",t),a.attr("alt",e))}function resize3DViewers(){for(var e in viewers3D){var t=viewers3D[e];if(t&&t.container){var a=t.container.offsetWidth,i=t.container.offsetHeight;t.camera.aspect=a/i,t.camera.updateProjectionMatrix(),t.renderer.setSize(a,i)}}}function initSoybeanViewer(){var e=document.getElementById("soybean-3d-viewer");if(e){e.innerHTML="";var t=new THREE.Scene,a=new THREE.PerspectiveCamera(75,e.offsetWidth/e.offsetHeight,.1,1e3),i=new THREE.WebGLRenderer({antialias:!0});i.setSize(e.offsetWidth,e.offsetHeight),i.setClearColor(16382457),i.shadowMap.enabled=!0,i.shadowMap.type=THREE.PCFSoftShadowMap,e.appendChild(i.domElement);var o=new THREE.AmbientLight(4210752,.4);t.add(o);var n=new THREE.DirectionalLight(16777215,.8);n.position.set(5,5,5),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,t.add(n);var r=new THREE.HemisphereLight(8900331,10025880,.3);t.add(r),a.position.set(0,0,5),soybeanViewer={scene:t,camera:a,renderer:i,container:e},loadSoybeanMesh(),addSoybeanControls(),animateSoybean()}}function loadSoybeanMesh(){soybeanViewer&&(soybeanMesh&&soybeanViewer.scene.remove(soybeanMesh),(new THREE.PLYLoader).load("./static/interpolation_3d/soybean/pca1/test.ply",function(e){var t=new THREE.MeshLambertMaterial({color:2263842,transparent:!0,opacity:.9,side:THREE.DoubleSide,vertexColors:!0});(soybeanMesh=new THREE.Mesh(e,t)).castShadow=!0,soybeanMesh.receiveShadow=!0,e.computeBoundingBox();var a=e.boundingBox.getCenter(new THREE.Vector3);e.translate(-a.x,-a.y,-a.z);var i=e.boundingBox.getSize(new THREE.Vector3),o=3/Math.max(i.x,i.y,i.z);soybeanMesh.scale.setScalar(o),soybeanViewer.scene.add(soybeanMesh);var n=soybeanViewer.container.querySelector(".viewer-loading");n&&(n.style.display="none")},function(e){console.log("Loading progress:",e.loaded/e.total*100+"%")},function(e){console.error("Error loading PLY file:",e);var t=soybeanViewer.container.querySelector(".viewer-loading");t&&(t.textContent="Error loading 3D model",t.style.color="#ff3860")}))}function addSoybeanControls(){var e=document.getElementById("soybean-3d-viewer");e&&(e.addEventListener("mousedown",function(t){isMouseDown=!0,mouseX=t.clientX,mouseY=t.clientY,e.style.cursor="grabbing"}),e.addEventListener("mouseup",function(){isMouseDown=!1,e.style.cursor="grab"}),e.addEventListener("mousemove",function(e){if(isMouseDown&&soybeanMesh){var t=e.clientX-mouseX,a=e.clientY-mouseY;rotationY+=.01*t,rotationX+=.01*a,rotationX=Math.max(-Math.PI/2,Math.min(Math.PI/2,rotationX)),soybeanMesh.rotation.x=rotationX,soybeanMesh.rotation.y=rotationY,mouseX=e.clientX,mouseY=e.clientY}}),e.addEventListener("wheel",function(e){if(e.preventDefault(),soybeanViewer){var t=.1,a=e.deltaY>0?1+t:1-t;soybeanViewer.camera.position.multiplyScalar(a);var i=soybeanViewer.camera.position.length();i<1?soybeanViewer.camera.position.normalize().multiplyScalar(1):i>20&&soybeanViewer.camera.position.normalize().multiplyScalar(20)}}),e.addEventListener("mouseleave",function(){isMouseDown=!1,e.style.cursor="grab"}))}function animateSoybean(){soybeanViewer&&(requestAnimationFrame(animateSoybean),!isMouseDown&&soybeanMesh&&(soybeanMesh.rotation.y+=.005),soybeanViewer.renderer.render(soybeanViewer.scene,soybeanViewer.camera))}function resizeSoybeanViewer(){if(soybeanViewer&&soybeanViewer.container){var e=soybeanViewer.container.offsetWidth,t=soybeanViewer.container.offsetHeight;soybeanViewer.camera.aspect=e/t,soybeanViewer.camera.updateProjectionMatrix(),soybeanViewer.renderer.setSize(e,t)}}function initOverviewViewer(){overviewState.images=[];for(var e=0;e<60;e++)overviewState.images.push({src:"./static/overview/"+e+".jpg",index:e});overviewState.totalImages=overviewState.images.length,overviewState.currentIndex=0,overviewState.isLoaded=!0,overviewState.isPlaying=!1,overviewState.playInterval=null,loadOverviewImage(0),setupOverviewNavigation(),setupOverviewPlayButton(),setupOverviewKeyboardNavigation(),setTimeout(function(){console.log("Initial state before starting auto-play:",overviewState.isPlaying),startOverviewAutoPlay()},100)}function loadOverviewImage(e){if(!(!overviewState.isLoaded||e<0||e>=overviewState.totalImages)){var t=document.getElementById("overview-image"),a=document.getElementById("overview-counter"),i=document.getElementById("overview-prev-btn"),o=document.getElementById("overview-next-btn");t&&a&&i&&o&&(t.src=overviewState.images[e].src,t.alt="Overview Image "+(e+1),a.textContent=e+1+" / "+overviewState.totalImages,i.disabled=0===e,o.disabled=e===overviewState.totalImages-1,overviewState.currentIndex=e)}}function setupOverviewPlayButton(){var e=document.getElementById("overview-play-btn"),t=document.getElementById("overview-play-icon");e&&t&&e.addEventListener("click",function(){console.log("Play button clicked, current state:",overviewState.isPlaying),overviewState.isPlaying?stopOverviewAutoPlay():startOverviewAutoPlay()})}function startOverviewAutoPlay(){if(!overviewState.isPlaying){console.log("Starting auto-play, setting icon to pause"),overviewState.isPlaying=!0;var e=document.getElementById("overview-play-icon");e?(e.setAttribute("class","fas fa-pause"),e.style.display="none",e.offsetHeight,e.style.display="",console.log("Icon set to pause:",e.className),console.log("Icon element found:",e)):console.log("Icon element NOT found!"),overviewState.playInterval=setInterval(function(){loadOverviewImage((overviewState.currentIndex+1)%overviewState.totalImages)},500)}}function stopOverviewAutoPlay(){if(overviewState.isPlaying){console.log("Stopping auto-play, setting icon to play"),overviewState.isPlaying=!1;var e=document.getElementById("overview-play-icon");e?(e.setAttribute("class","fas fa-play"),e.style.display="none",e.offsetHeight,e.style.display="",console.log("Icon set to play:",e.className),console.log("Icon element found:",e)):console.log("Icon element NOT found!"),overviewState.playInterval&&(clearInterval(overviewState.playInterval),overviewState.playInterval=null)}}function setupOverviewNavigation(){var e=document.getElementById("overview-prev-btn"),t=document.getElementById("overview-next-btn");e&&e.addEventListener("click",function(){overviewState.isPlaying&&stopOverviewAutoPlay(),overviewState.currentIndex>0&&loadOverviewImage(overviewState.currentIndex-1)}),t&&t.addEventListener("click",function(){overviewState.isPlaying&&stopOverviewAutoPlay(),overviewState.currentIndex<overviewState.totalImages-1&&loadOverviewImage(overviewState.currentIndex+1)})}function setupOverviewKeyboardNavigation(){document.addEventListener("keydown",function(e){var t=document.querySelector(".overview-viewer-container");if(t&&overviewState.isLoaded){var a=t.getBoundingClientRect();if(a.top<window.innerHeight&&a.bottom>0)switch(e.key){case"ArrowLeft":e.preventDefault(),overviewState.isPlaying&&stopOverviewAutoPlay(),overviewState.currentIndex>0&&loadOverviewImage(overviewState.currentIndex-1);break;case"ArrowRight":e.preventDefault(),overviewState.isPlaying&&stopOverviewAutoPlay(),overviewState.currentIndex<overviewState.totalImages-1&&loadOverviewImage(overviewState.currentIndex+1);break;case" ":e.preventDefault(),overviewState.isPlaying?stopOverviewAutoPlay():startOverviewAutoPlay()}}})}function initReconstructionViewers(){reconstructionState.viewers.gt=createReconstructionViewer("reconstruction-gt-viewer"),reconstructionState.viewers.lsys=createReconstructionViewer("reconstruction-lsys-viewer"),reconstructionState.viewers.nksr=createReconstructionViewer("reconstruction-nksr-viewer"),reconstructionState.viewers.our=createReconstructionViewer("reconstruction-our-viewer"),loadReconstructionMeshes(),addReconstructionControls("gt"),addReconstructionControls("lsys"),addReconstructionControls("nksr"),addReconstructionControls("our"),animateReconstruction("gt"),animateReconstruction("lsys"),animateReconstruction("nksr"),animateReconstruction("our")}function createReconstructionViewer(e){var t=document.getElementById(e);if(!t)return null;t.innerHTML="";var a=new THREE.Scene,i=new THREE.PerspectiveCamera(60,t.offsetWidth/t.offsetHeight,.01,1e3),o=new THREE.WebGLRenderer({antialias:!0});o.setSize(t.offsetWidth,t.offsetHeight),o.setClearColor(16382457),o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,t.appendChild(o.domElement);var n=new THREE.AmbientLight(4210752,1.2);a.add(n);var r=new THREE.DirectionalLight(16777215,1.2);r.position.set(2,4,3),r.castShadow=!0,r.shadow.mapSize.width=1024,r.shadow.mapSize.height=1024,a.add(r);var s=new THREE.DirectionalLight(16777215,.6);s.position.set(-2,-4,-3),a.add(s);var c=new THREE.HemisphereLight(8900331,10025880,.4);return a.add(c),i.position.set(0,0,3.5),{scene:a,camera:i,renderer:o,container:t,object:null}}function reconstructionBasePath(){return"./static/reconstruction_3d/soybean/"+reconstructionState.currentFolder+"/"}function loadReconstructionMeshes(){loadReconstructionMesh("gt","gt.ply"),loadReconstructionMesh("lsys","Lsys.ply"),loadReconstructionMesh("nksr","nksr.ply"),loadReconstructionMesh("our","our.ply")}function loadReconstructionMesh(e,t){var a=reconstructionState.viewers[e];a&&(reconstructionState.meshes[e]&&a.scene.remove(reconstructionState.meshes[e]),(new THREE.PLYLoader).load(reconstructionBasePath()+t,function(t){t.computeBoundingBox();var i=t.boundingBox.getCenter(new THREE.Vector3);t.translate(-i.x,-i.y,-i.z);var o,n=t.boundingBox.getSize(new THREE.Vector3),r=2/Math.max(n.x,n.y,n.z);if(t.scale(r,r,r),"gt"===e){var s=new THREE.PointsMaterial({size:.01,color:8947848,vertexColors:!0});o=new THREE.Points(t,s)}else{s=new THREE.MeshStandardMaterial({color:8947848,metalness:0,roughness:.3,side:THREE.DoubleSide,vertexColors:!0});(o=new THREE.Mesh(t,s)).castShadow=!0,o.receiveShadow=!0}var c=e+"X",l=e+"Y";o.rotation.x=reconstructionState.rotation[c],o.rotation.y=reconstructionState.rotation[l],reconstructionState.meshes[e]=o,a.object=o,a.scene.add(o);var d=a.container.querySelector(".viewer-loading");d&&(d.style.display="none")},void 0,function(i){console.error("Failed to load "+t,i);var o=a.container.querySelector(".viewer-loading");o&&(o.textContent="Failed to load "+e,o.style.color="#ff3860")}))}function addReconstructionControls(e){var t=reconstructionState.viewers[e];if(t){var a=e+"X",i=e+"Y";t.container.addEventListener("mousedown",function(a){reconstructionState.isDragging[e]=!0,reconstructionState.lastMouse.x=a.clientX,reconstructionState.lastMouse.y=a.clientY,t.container.style.cursor="grabbing"}),t.container.addEventListener("mouseup",function(){reconstructionState.isDragging[e]=!1,t.container.style.cursor="grab"}),t.container.addEventListener("mouseleave",function(){reconstructionState.isDragging[e]=!1,t.container.style.cursor="grab"}),t.container.addEventListener("mousemove",function(o){if(reconstructionState.isDragging[e]&&t.object){var n=o.clientX-reconstructionState.lastMouse.x,r=o.clientY-reconstructionState.lastMouse.y;reconstructionState.rotation[i]+=.01*n,reconstructionState.rotation[a]+=.01*r,reconstructionState.rotation[a]=Math.max(-Math.PI/2,Math.min(Math.PI/2,reconstructionState.rotation[a])),t.object.rotation.x=reconstructionState.rotation[a],t.object.rotation.y=reconstructionState.rotation[i],reconstructionState.lastMouse.x=o.clientX,reconstructionState.lastMouse.y=o.clientY}}),t.container.addEventListener("wheel",function(e){e.preventDefault();var a=e.deltaY>0?1.1:.9;t.camera.position.multiplyScalar(a);var i=t.camera.position.length();i<1&&t.camera.position.normalize().multiplyScalar(1),i>20&&t.camera.position.normalize().multiplyScalar(20)},{passive:!1})}}function animateReconstruction(e){function t(){requestAnimationFrame(t),!reconstructionState.isDragging[e]&&a.object&&(a.object.rotation.z+=.005),a.renderer.render(a.scene,a.camera)}var a=reconstructionState.viewers[e];a&&t()}function resizeReconstructionViewers(){["gt","lsys","nksr","our"].forEach(function(e){var t=reconstructionState.viewers[e];if(t&&t.container){var a=t.container.offsetWidth,i=t.container.offsetHeight;t.camera.aspect=a/i,t.camera.updateProjectionMatrix(),t.renderer.setSize(a,i)}})}function initSoyfitViewers(){updateSoyfitImage(),soyfitState.viewers.pcd=createBasicViewer("soyfit-pcd-viewer"),soyfitState.viewers.mesh=createBasicViewer("soyfit-mesh-viewer"),loadSoyfitPCD(),loadSoyfitMesh(),addDragZoomControls("pcd"),addDragZoomControls("mesh"),animateSoyfit("pcd"),animateSoyfit("mesh")}function soyfitBasePath(){return"./static/fitting_3d/"+soyfitState.currentSpecies+"/"+soyfitState.currentId+"/"}function updateSoyfitImage(){var e=document.getElementById("soyfit-image");e&&(e.src=soyfitBasePath()+"image.jpg")}function createBasicViewer(e){var t=document.getElementById(e);if(!t)return null;t.innerHTML="";var a=new THREE.Scene,i=new THREE.PerspectiveCamera(60,t.offsetWidth/t.offsetHeight,.01,1e3),o=new THREE.WebGLRenderer({antialias:!0});o.setSize(t.offsetWidth,t.offsetHeight),o.setClearColor(16382457),t.appendChild(o.domElement);var n=new THREE.AmbientLight(4210752,.6);a.add(n);var r=new THREE.DirectionalLight(16777215,.8);return r.position.set(2,4,3),a.add(r),i.position.set(0,0,3.5),{scene:a,camera:i,renderer:o,container:t,object:null}}function centerAndScaleGeometry(e,t){e.computeBoundingBox();var a=e.boundingBox.getCenter(new THREE.Vector3);e.translate(-a.x,-a.y,-a.z);var i=e.boundingBox.getSize(new THREE.Vector3),o=(t||2.5)/Math.max(i.x,i.y,i.z);e.scale(o,o,o)}function loadSoyfitPCD(){var e=soyfitState.viewers.pcd;e&&(e.object&&e.scene.remove(e.object),(new THREE.PLYLoader).load(soyfitBasePath()+"gt_pcd.ply",function(t){centerAndScaleGeometry(t,2);var a=new THREE.PointsMaterial({size:.01,vertexColors:!0}),i=new THREE.Points(t,a);i.rotation.x=soyfitState.rotation.pcdX,i.rotation.y=soyfitState.rotation.pcdY,e.object=i,e.scene.add(i);var o=e.container.querySelector(".viewer-loading");o&&(o.style.display="none")},void 0,function(t){console.error("Failed to load gt_pcd.ply",t);var a=e.container.querySelector(".viewer-loading");a&&(a.textContent="Failed to load point cloud",a.style.color="#ff3860")}))}function loadSoyfitMesh(){var e=soyfitState.viewers.mesh;e&&(e.object&&e.scene.remove(e.object),(new THREE.PLYLoader).load(soyfitBasePath()+"mesh.ply",function(t){centerAndScaleGeometry(t,2);var a=new THREE.MeshStandardMaterial({vertexColors:!0,metalness:.05,roughness:.9,side:THREE.DoubleSide}),i=new THREE.Mesh(t,a);i.rotation.x=soyfitState.rotation.meshX,i.rotation.y=soyfitState.rotation.meshY,e.object=i,e.scene.add(i);var o=e.container.querySelector(".viewer-loading");o&&(o.style.display="none")},void 0,function(t){console.error("Failed to load mesh.ply",t);var a=e.container.querySelector(".viewer-loading");a&&(a.textContent="Failed to load mesh",a.style.color="#ff3860")}))}function addDragZoomControls(e){var t=soyfitState.viewers[e];if(t){var a="pcd"===e?"pcd":"mesh",i="pcd"===e?"pcdX":"meshX",o="pcd"===e?"pcdY":"meshY";t.container.addEventListener("mousedown",function(e){soyfitState.isDragging[a]=!0,soyfitState.lastMouse.x=e.clientX,soyfitState.lastMouse.y=e.clientY,t.container.style.cursor="grabbing"}),t.container.addEventListener("mouseup",function(){soyfitState.isDragging[a]=!1,t.container.style.cursor="grab"}),t.container.addEventListener("mouseleave",function(){soyfitState.isDragging[a]=!1,t.container.style.cursor="grab"}),t.container.addEventListener("mousemove",function(e){if(soyfitState.isDragging[a]&&t.object){var n=e.clientX-soyfitState.lastMouse.x,r=e.clientY-soyfitState.lastMouse.y;soyfitState.rotation[o]+=.01*n,soyfitState.rotation[i]+=.01*r,soyfitState.rotation[i]=Math.max(-Math.PI/2,Math.min(Math.PI/2,soyfitState.rotation[i])),t.object.rotation.x=soyfitState.rotation[i],t.object.rotation.y=soyfitState.rotation[o],soyfitState.lastMouse.x=e.clientX,soyfitState.lastMouse.y=e.clientY}}),t.container.addEventListener("wheel",function(e){e.preventDefault();var a=e.deltaY>0?1.1:.9;t.camera.position.multiplyScalar(a);var i=t.camera.position.length();i<1&&t.camera.position.normalize().multiplyScalar(1),i>20&&t.camera.position.normalize().multiplyScalar(20)},{passive:!1})}}function animateSoyfit(e){function t(){requestAnimationFrame(t),!soyfitState.isDragging[e]&&a.object&&(a.object.rotation.z+=.005),a.renderer.render(a.scene,a.camera)}var a=soyfitState.viewers[e];a&&t()}function resizeSoyfitViewers(){["pcd","mesh"].forEach(function(e){var t=soyfitState.viewers[e];if(t&&t.container){var a=t.container.offsetWidth,i=t.container.offsetHeight;t.camera.aspect=a/i,t.camera.updateProjectionMatrix(),t.renderer.setSize(a,i)}})}window.HELP_IMPROVE_VIDEOJS=!1;var INTERP_BASE="./static/interpolation/stacked",PCA_BASE="./static/interpolation",PCA_3D_BASE="./static/interpolation_3d",PCA_3D_LEAF_BASE="./static/interpolation_3d_leaf",PCA_3D_STEM_BASE="./static/interpolation_3d_stem",currentSpecies="Papaya",currentSpecies3D="Papaya",currentSpecies3DLeaf="Papaya",currentSpecies3DStem="Papaya",speciesConfig={Papaya:{base:"./static/interpolation/papaya"},Soybean:{base:"./static/interpolation/soybean"},Geranium:{base:"./static/interpolation/geranium"},Tobacco:{base:"./static/interpolation/tobacco"}},speciesConfig3D={Papaya:{base:"./static/interpolation_3d/papaya"},Soybean:{base:"./static/interpolation_3d/soybean"},Geranium:{base:"./static/interpolation_3d/geranium"},Tobacco:{base:"./static/interpolation_3d/tobacco"}},speciesConfig3DLeaf={Papaya:{base:"./static/interpolation_3d_leaf/papaya"},Soybean:{base:"./static/interpolation_3d_leaf/soybean"},Geranium:{base:"./static/interpolation_3d_leaf/geranium"},Tobacco:{base:"./static/interpolation_3d_leaf/tobacco"}},speciesConfig3DStem={Papaya:{base:"./static/interpolation_3d_stem/papaya"},Soybean:{base:"./static/interpolation_3d_stem/soybean"},Geranium:{base:"./static/interpolation_3d_stem/geranium"},Tobacco:{base:"./static/interpolation_3d_stem/tobacco"}},NUM_INTERP_FRAMES=50,interp_images=[],pca_images={1:[],2:[],3:[],4:[]},pca_images_3d_leaf={1:[],2:[],3:[],4:[]},pca_images_3d_stem={1:[],2:[],3:[],4:[]},viewers3D={},currentMeshes3D={},soybeanViewer=null,soybeanMesh=null,isMouseDown=!1,mouseX=0,mouseY=0,rotationX=0,rotationY=0,soyfitState={currentId:"1",currentSpecies:"soybean",pcd:null,mesh:null,viewers:{pcd:null,mesh:null},isDragging:{pcd:!1,mesh:!1},lastMouse:{x:0,y:0},rotation:{pcdX:-1.5,pcdY:0,meshX:-1.5,meshY:0}},overviewState={currentIndex:0,images:[],totalImages:0,isLoaded:!1,isPlaying:!1,playInterval:null},reconstructionState={currentFolder:"15_i",viewers:{gt:null,lsys:null,nksr:null,our:null},meshes:{gt:null,lsys:null,nksr:null,our:null},isDragging:{gt:!1,lsys:!1,nksr:!1,our:!1},lastMouse:{x:0,y:0},rotation:{gtX:-1.5,gtY:0,lsysX:-1.5,lsysY:0,nksrX:-1.5,nksrY:0,ourX:-1.5,ourY:0}};$(document).ready(function(){$(".navbar-burger").click(function(){$(".navbar-burger").toggleClass("is-active"),$(".navbar-menu").toggleClass("is-active")});for(var e={slidesToScroll:1,slidesToShow:3,loop:!0,infinite:!0,autoplay:!1,autoplaySpeed:3e3},t=bulmaCarousel.attach(".carousel",e),a=0;a<t.length;a++)t[a].on("before:show",e=>{console.log(e)});var i=document.querySelector("#my-element");i&&i.bulmaCarousel&&i.bulmaCarousel.on("before-show",function(e){console.log(e)}),preloadInterpolationImages(),preloadPCAImagesForSpecies(currentSpecies),preloadPCAImagesForSpecies3DLeaf(currentSpecies3DLeaf),preloadPCAImagesForSpecies3DStem(currentSpecies3DStem),updateSpeciesImage(currentSpecies);for(a=1;a<=4;a++){var o="#pca"+a+"-slider";$(o).on("input",function(){var e=this.id.replace("pca","").replace("-slider","");setPCAImage(this.value,e)}),setPCAImage(0,a),$(o).prop("max",NUM_INTERP_FRAMES-1)}updateSpeciesImage3D(currentSpecies3D);for(a=1;a<=4;a++){init3DViewer(a);o="#pca"+a+"-slider-3d";$(o).on("input",function(){load3DMesh(this.id.replace("pca","").replace("-slider-3d",""),this.value)}),$(o).prop("max",NUM_INTERP_FRAMES-1)}updateSpeciesImage3DLeaf(currentSpecies3DLeaf);for(a=1;a<=4;a++){o="#pca"+a+"-slider-3d-leaf";$(o).on("input",function(){var e=this.id.replace("pca","").replace("-slider-3d-leaf","");setPCAImage3DLeaf(this.value,e)}),$(o).prop("max",NUM_INTERP_FRAMES-1),setPCAImage3DLeaf(0,a)}updateSpeciesImage3DStem(currentSpecies3DStem);for(a=1;a<=4;a++){o="#pca"+a+"-slider-3d-stem";$(o).on("input",function(){var e=this.id.replace("pca","").replace("-slider-3d-stem","");setPCAImage3DStem(this.value,e)}),$(o).prop("max",NUM_INTERP_FRAMES-1),setPCAImage3DStem(0,a)}bulmaSlider.attach(),$(".species-box").on("click",function(){var e=$(this).data("species");if(e!==currentSpecies){currentSpecies=e,$(".species-box").removeClass("is-active"),$(this).addClass("is-active"),$("#species-label").text(currentSpecies),updateSpeciesImage(currentSpecies),preloadPCAImagesForSpecies(currentSpecies);for(var t=1;t<=4;t++){$("#pca"+t+"-slider").val(0),setPCAImage(0,t)}}}),$(".species-box-3d").on("click",function(){var e=$(this).data("species");if(e!==currentSpecies3D){currentSpecies3D=e,$(".species-box-3d").removeClass("is-active"),$(this).addClass("is-active"),$("#species-label-3d").text(currentSpecies3D),updateSpeciesImage3D(currentSpecies3D);for(var t=1;t<=4;t++){$("#pca"+t+"-slider-3d").val(0),load3DMesh(t,0)}}}),$(".species-box-3d-leaf").on("click",function(){var e=$(this).data("species");if(e!==currentSpecies3DLeaf){currentSpecies3DLeaf=e,$(".species-box-3d-leaf").removeClass("is-active"),$(this).addClass("is-active"),$("#species-label-3d-leaf").text(currentSpecies3DLeaf),updateSpeciesImage3DLeaf(currentSpecies3DLeaf),preloadPCAImagesForSpecies3DLeaf(currentSpecies3DLeaf);for(var t=1;t<=4;t++){$("#pca"+t+"-slider-3d-leaf").val(0),setPCAImage3DLeaf(0,t)}}}),$(".species-box-3d-stem").on("click",function(){var e=$(this).data("species");if(e!==currentSpecies3DStem){currentSpecies3DStem=e,$(".species-box-3d-stem").removeClass("is-active"),$(this).addClass("is-active"),$("#species-label-3d-stem").text(currentSpecies3DStem),updateSpeciesImage3DStem(currentSpecies3DStem),preloadPCAImagesForSpecies3DStem(currentSpecies3DStem);for(var t=1;t<=4;t++){$("#pca"+t+"-slider-3d-stem").val(0),setPCAImage3DStem(0,t)}}}),$(window).on("resize",function(){resize3DViewers(),resizeSoybeanViewer(),resizeSoyfitViewers(),resizeReconstructionViewers()}),initSoybeanViewer(),initSoyfitViewers(),$(".soybean-fit-btn").on("click",function(){var e=$(this).data("fit-id").toString();e===soyfitState.currentId&&"soybean"===soyfitState.currentSpecies||($(".soybean-fit-btn").removeClass("is-active"),$(".ribes-fit-btn").removeClass("is-active"),$(".maize-fit-btn").removeClass("is-active"),$(".tobacco-fit-btn").removeClass("is-active"),$(this).addClass("is-active"),soyfitState.currentId=e,soyfitState.currentSpecies="soybean",updateSoyfitImage(),soyfitState.rotation={pcdX:-1.5,pcdY:0,meshX:-1.5,meshY:0},loadSoyfitPCD(),loadSoyfitMesh())}),$(".ribes-fit-btn").on("click",function(){var e=$(this).data("fit-id").toString();e===soyfitState.currentId&&"ribes"===soyfitState.currentSpecies||($(".soybean-fit-btn").removeClass("is-active"),$(".ribes-fit-btn").removeClass("is-active"),$(".maize-fit-btn").removeClass("is-active"),$(".tobacco-fit-btn").removeClass("is-active"),$(this).addClass("is-active"),soyfitState.currentId=e,soyfitState.currentSpecies="ribes",updateSoyfitImage(),soyfitState.rotation={pcdX:-1.5,pcdY:0,meshX:-1.5,meshY:0},loadSoyfitPCD(),loadSoyfitMesh())}),$(".maize-fit-btn").on("click",function(){var e=$(this).data("fit-id").toString();e===soyfitState.currentId&&"maize"===soyfitState.currentSpecies||($(".soybean-fit-btn").removeClass("is-active"),$(".ribes-fit-btn").removeClass("is-active"),$(".maize-fit-btn").removeClass("is-active"),$(".tobacco-fit-btn").removeClass("is-active"),$(this).addClass("is-active"),soyfitState.currentId=e,soyfitState.currentSpecies="maize",updateSoyfitImage(),soyfitState.rotation={pcdX:-1.5,pcdY:0,meshX:-1.5,meshY:0},loadSoyfitPCD(),loadSoyfitMesh())}),$(".tobacco-fit-btn").on("click",function(){var e=$(this).data("fit-id").toString();e===soyfitState.currentId&&"tobacco"===soyfitState.currentSpecies||($(".soybean-fit-btn").removeClass("is-active"),$(".ribes-fit-btn").removeClass("is-active"),$(".maize-fit-btn").removeClass("is-active"),$(".tobacco-fit-btn").removeClass("is-active"),$(this).addClass("is-active"),soyfitState.currentId=e,soyfitState.currentSpecies="tobacco",updateSoyfitImage(),soyfitState.rotation={pcdX:-1.5,pcdY:0,meshX:-1.5,meshY:0},loadSoyfitPCD(),loadSoyfitMesh())}),initOverviewViewer(),initReconstructionViewers(),$(".reconstruction-folder-btn").on("click",function(){var e=$(this).data("folder");e!==reconstructionState.currentFolder&&($(".reconstruction-folder-btn").removeClass("is-active"),$(this).addClass("is-active"),reconstructionState.currentFolder=e,reconstructionState.rotation={gtX:-1.5,gtY:0,lsysX:-1.5,lsysY:0,nksrX:-1.5,nksrY:0,ourX:-1.5,ourY:0},loadReconstructionMeshes())})});